const fs = require('fs');
const path = require('path');
const paths = require('./paths');

const appDirectory = fs.realpathSync(process.cwd());
process.env.NODE_PATH = (process.env.NODE_PATH || '')
  .split(path.delimiter)
  .filter(folder => folder && !path.isAbsolute(folder))
  .map(folder => path.resolve(appDirectory, folder))
  .join(path.delimiter);

function getClientEnvironment(publicUrl) {
	const raw = Object.keys(process.env)
		.reduce(
			(env, key) => {
				env[key] = process.env[key];
				return env;
			},
			{
				NODE_ENV: process.env.NODE_ENV || 'development',
				PUBLIC_URL: publicUrl,
			}
		);
	// Stringify all values so we can feed into Webpack DefinePlugin
	const stringified = {
		'process.env': Object.keys(raw).reduce(
			(env, key) => {
				env[key] = JSON.stringify(raw[key]);
				return env;
			},
			{}
		),
	};

	return { raw, stringified };
}

module.exports = getClientEnvironment;
