const { spawn } = require("child_process");

const doCMD = (command) => {

	return new Promise( (good, fail) => {
	console.log(`running ${command} `);

		const child = spawn(command, { stdio: 'inherit', shell: true });

		child.on("exit", (code) => code ? fail(code) : good(code) );
	}).then( x => { console.log(x); return x; });
};

const runPrettierGQL = () => doCMD( "./node_modules/.bin/prettier --parser graphql --use-tabs --tab-width 4 --trailing-comma all --write \"src/**/*.graphql\"");
const runPrettierJS = () => doCMD( "./node_modules/.bin/prettier --use-tabs --tab-width 4 --trailing-comma all --write \"src/**/*.js\"");
const runESLint = () => doCMD("./node_modules/.bin/eslint --fix src");
const runReAdd = () => doCMD("git add -u");

const runFormat = () => runPrettierJS()
	.catch( console.error) 
	.then(runPrettierGQL)
	.catch( console.error) 
	.then(runESLint)
	.catch( console.error) 
	.then(runReAdd)
	.catch( console.error);

runFormat();
